<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa Interativo de Exoplanetas - Stellar Worlds AI</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at center, #000010 0%, #000000 100%);
      font-family: 'Segoe UI', sans-serif;
      color: white;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    #info-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.5);
      padding: 12px 18px;
      border-radius: 10px;
      backdrop-filter: blur(5px);
    }
    #info-panel span {
      display: block;
      font-size: 14px;
      margin: 3px 0;
    }
    #tooltip {
      position: absolute;
      pointer-events: none;
      background: rgba(255, 215, 0, 0.9);
      color: #000;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 13px;
      display: none;
      white-space: nowrap;
    }
    #side-panel {
      position: absolute;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 20px;
      box-shadow: -2px 0 10px rgba(255, 215, 0, 0.2);
      transition: right 0.4s ease;
      overflow-y: auto;
    }
    #side-panel.open {
      right: 0;
    }
    #side-panel h2 {
      color: gold;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div id="info-panel">
    <span>ðŸŒŒ Planetas carregados: <strong id="count">0</strong></span>
    <span>Velocidade da animaÃ§Ã£o:</span>
    <input type="range" id="speed" min="0" max="2" step="0.01" value="0.5" />
  </div>
  <div id="tooltip"></div>
  <div id="side-panel">
    <h2>Exoplaneta</h2>
    <div id="planet-info">Clique em um planeta para ver detalhes.</div>
  </div>
  <canvas id="galaxy"></canvas>

  <script>
    const canvas = document.getElementById("galaxy");
    const ctx = canvas.getContext("2d");
    const tooltip = document.getElementById("tooltip");
    const sidePanel = document.getElementById("side-panel");
    const planetInfo = document.getElementById("planet-info");
    const countEl = document.getElementById("count");
    const speedInput = document.getElementById("speed");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let planets = [];
    let angleOffset = 0;

    async function fetchPlanets() {
      try {
        const res = await fetch("https://alessandrosamir.app.n8n.cloud/webhook/06b68ce9-deea-47b6-a7a2-429083e10efd");
        const data = await res.json();

        planets = data.map((p, i) => ({
          name: p.pl_name || `Planeta ${i}`,
          host: p.hostname || "Desconhecida",
          distance: p.st_dist || "N/A",
          radius: p.pl_rade || Math.random() * 2 + 0.5,
          orbit: Math.random() * 250 + 50,
          angle: Math.random() * Math.PI * 2,
          speed: Math.random() * 0.002 + 0.001,
        }));

        countEl.textContent = planets.length;
      } catch (err) {
        console.error("Erro ao buscar exoplanetas:", err);
      }
    }

    function drawGalaxy() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // fundo de estrelas
      for (let i = 0; i < 100; i++) {
        ctx.fillStyle = `rgba(255, 215, 0, ${Math.random() * 0.3})`;
        ctx.fillRect(Math.random() * canvas.width, Math.random() * canvas.height, 1, 1);
      }

      const cx = canvas.width / 2;
      const cy = canvas.height / 2;

      planets.forEach((p) => {
        const x = cx + Math.cos(p.angle + angleOffset) * p.orbit;
        const y = cy + Math.sin(p.angle + angleOffset) * p.orbit;

        ctx.beginPath();
        ctx.arc(x, y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = "gold";
        ctx.fill();

        p._x = x;
        p._y = y;
      });

      angleOffset += speedInput.value / 50;
      requestAnimationFrame(drawGalaxy);
    }

    canvas.addEventListener("mousemove", (e) => {
      let found = null;
      for (let p of planets) {
        if (Math.hypot(p._x - e.clientX, p._y - e.clientY) < 6) {
          found = p;
          break;
        }
      }
      if (found) {
        tooltip.style.display = "block";
        tooltip.style.left = e.clientX + 10 + "px";
        tooltip.style.top = e.clientY + 10 + "px";
        tooltip.innerHTML = `<strong>${found.name}</strong><br>ðŸŒ  ${found.host}`;
      } else {
        tooltip.style.display = "none";
      }
    });

    canvas.addEventListener("click", (e) => {
      for (let p of planets) {
        if (Math.hypot(p._x - e.clientX, p._y - e.clientY) < 6) {
          sidePanel.classList.add("open");
          planetInfo.innerHTML = `
            <h3>${p.name}</h3>
            <p><strong>Estrela hospedeira:</strong> ${p.host}</p>
            <p><strong>DistÃ¢ncia da Terra:</strong> ${p.distance} parsecs</p>
            <p><strong>Raio (em raios terrestres):</strong> ${p.radius.toFixed(2)}</p>
          `;
          return;
        }
      }
    });

    document.body.addEventListener("click", (e) => {
      if (!sidePanel.contains(e.target) && e.target.tagName !== "CANVAS") {
        sidePanel.classList.remove("open");
      }
    });

    fetchPlanets().then(drawGalaxy);
  </script>
</body>
</html>
